-- [[ tri73637 - FIX AUTO COLLECT ]] --
local lp = game:GetService("Players").LocalPlayer

-- Cấu hình
local RANGE = 25 -- Tầm nhặt
local SPEED = 0.2 -- Tốc độ nhặt

task.spawn(function()
    while task.wait(SPEED) do
        local character = lp.Character
        local hrp = character and character:FindFirstChild("HumanoidRootPart")
        
        if hrp then
            -- Dùng pcall để tránh script bị dừng nếu gặp vật thể lỗi
            pcall(function()
                -- Quét các vật thể có ProximityPrompt trong tầm mắt
                for _, v in pairs(workspace:GetDescendants()) do
                    if v:IsA("ProximityPrompt") then
                        -- Lấy vị trí vật thể (chính xác cho cả Model và Part)
                        local target = v.Parent
                        local pos = nil
                        
                        if target:IsA("BasePart") then
                            pos = target.Position
                        elseif target:IsA("Model") then
                            pos = target:GetModelCFrame().Position
                        end
                        
                        -- Kiểm tra khoảng cách
                        if pos and (hrp.Position - pos).Magnitude <= RANGE then
                            -- Chỉnh thời gian nhặt về 0 ngay lập tức
                            v.HoldDuration = 0
                            -- Kích hoạt nhặt (Dùng task.spawn để không làm khựng nhân vật)
                            task.spawn(function()
                                fireproximityprompt(v)
                            end)
                        end
                    end
                end
            end)
        end
    end
end)
