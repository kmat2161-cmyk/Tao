-- [[ tri73637 - SMOOTH COLLECT PRO ]] --
local lp = game:GetService("Players").LocalPlayer
local pps = game:GetService("ProximityPromptService")

-- Cấu hình tối ưu
local RANGE = 20 -- Khoảng cách nhặt (giảm xuống 20 để ổn định hơn)
local SCAN_DELAY = 0.3 -- Tần suất quét (0.3s là hoàn hảo để không lag)

task.spawn(function()
    while true do
        task.wait(SCAN_DELAY)
        
        local character = lp.Character
        local hrp = character and character:FindFirstChild("HumanoidRootPart")
        
        if hrp then
            -- Chỉ quét các Prompt đang hoạt động trong hệ thống
            -- Cách này nhanh gấp 100 lần GetDescendants
            for _, prompt in pairs(pps:GetEventListeners()) do
                if prompt:IsA("ProximityPrompt") then
                    local part = prompt.Parent
                    if part and part:IsA("BasePart") then
                        local distance = (hrp.Position - part.Position).Magnitude
                        
                        if distance <= RANGE then
                            -- TỐI ƯU QUAN TRỌNG:
                            -- 1. Bỏ thời gian chờ nhặt
                            prompt.HoldDuration = 0
                            
                            -- 2. Dùng defer để lệnh nhặt chạy sau lệnh di chuyển
                            -- Điều này giúp nhân vật không bị khựng (stutter)
                            task.defer(function()
                                fireproximityprompt(prompt)
                            end)
                        end
                    end
                end
            end
        end
    end
end)
